import{j as r,R as h,C as v,B as m,r as u,A as y,a as b}from"./index-2efe3662.js";function p(e){return r.jsx(r.Fragment,{children:r.jsx(h,{children:Object.keys(e.Accounts).map(n=>r.jsxs(v,{xs:"auto",sm:"auto",md:"auto",lg:"auto",className:"m-3 p-3 border border-dark rounded",children:[r.jsxs("div",{className:"mb-1",children:["会計ID:",n]}),r.jsxs("div",{children:["処理状況：",e.Accounts[n].order_status==="ordered"&&r.jsx("span",{className:"text-warning",children:"注文済み"}),e.Accounts[n].order_status==="progress"&&r.jsx("span",{className:"text-danger",children:"準備中"}),e.Accounts[n].order_status==="completed"&&r.jsx("span",{className:"text-primary",children:"完了・引き渡し済み"})]}),r.jsxs("div",{className:"my-2",children:["注文内容",r.jsx("ul",{className:"fs-4",children:e.Accounts[n].items.map(c=>r.jsxs("li",{children:[c.item.name,"＊",r.jsx("span",{className:c.quantity>1?"text-danger":"",children:c.quantity}),c.children.length?r.jsx("ul",{children:c.children.map(s=>r.jsxs("li",{children:[s.item.name,"＊",r.jsx("span",{className:s.quantity>1?"text-danger":"",children:s.quantity})]},s.accountItemId))}):""]},c.accountItemId))})]}),r.jsxs("div",{children:[r.jsx(m,{variant:"outline-success",type:"button",value:n,onClick:e.changeToOrdered,className:"d-block w-100 py-2 mb-2",children:"注文済み"}),r.jsx(m,{variant:"secondary",type:"button",value:n,onClick:e.changeToProgress,className:"d-block w-100 py-2 mb-2",children:"準備中"}),r.jsx(m,{variant:"primary",type:"button",value:n,onClick:e.changeToCompleted,className:"d-block w-100 py-2 mb-2",children:"完了・引き渡し済み"})]})]},n))})})}function E(){const e=u.useRef(null),n=u.useCallback(s=>{if(e.current!==null||s.esUrl==="")return;const o=new EventSource(s.esUrl);o.onopen=function(a){console.log("es was opened"),s.onOpen&&s.onOpen(a)},o.onmessage=function(a){const i=JSON.parse(a.data),l={...a,data:i};s.onMessage&&s.onMessage(l)},o.onerror=function(a){s.onError&&s.onError(a)},e.current=o},[]),c=u.useCallback(()=>{e.current!==null&&(e.current.close(),e.current=null,console.log("es was closed"))},[e.current]);return{openES:n,closeES:c,ESRef:e}}function w(){const[e,n]=u.useState({}),{openES:c,closeES:s}=E(),o=u.useRef(null),a=u.useRef(null);u.useEffect(()=>{if(o.current=document.getElementById("project"),a.current=document.getElementById("progress"),!(!o.current||!a.current))return c({esUrl:`/api/v1/project/${o.current.value}/account?sse=true&order_status=ordered&progress=${a.current.value}`,onMessage:i}),()=>{s()}},[]);function i(t){t.data.order_status!=="completed"&&(e[t.data.accountId]=t.data,n({...e}))}async function l(t,d){if(!o.current||!a.current)return;const g=new y({project:o.current.value});g.setResourceId(t),e[t].order_status=d,await g.update(e[t]),n({...e})}function x(t){l(t.currentTarget.value,"ordered")}function j(t){l(t.currentTarget.value,"progress")}async function f(t){const d=t.currentTarget.value;await l(t.currentTarget.value,"completed"),e[d]&&delete e[d],n({...e})}return r.jsx(r.Fragment,{children:r.jsx(p,{Accounts:e,changeToCompleted:f,changeToOrdered:x,changeToProgress:j})})}b("root",r.jsx(w,{}));

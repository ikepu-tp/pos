import{j as n,R as h,C as v,B as m,r as u,A as y,a as b}from"./index-75fb56bb.js";function p(e){return n.jsx(n.Fragment,{children:n.jsx(h,{children:Object.keys(e.Accounts).map(r=>n.jsxs(v,{xs:"auto",sm:"auto",md:"auto",lg:"auto",className:"m-3 p-3 border border-dark rounded",children:[n.jsxs("div",{className:"mb-1",children:["会計ID:",r]}),n.jsxs("div",{children:["処理状況：",e.Accounts[r].order_status==="ordered"&&n.jsx("span",{className:"text-warning",children:"注文済み"}),e.Accounts[r].order_status==="progress"&&n.jsx("span",{className:"text-danger",children:"準備中"}),e.Accounts[r].order_status==="completed"&&n.jsx("span",{className:"text-primary",children:"完了・引き渡し済み"})]}),n.jsxs("div",{className:"my-2",children:["注文内容",n.jsx("ul",{className:"fs-4",children:e.Accounts[r].items.map(c=>n.jsxs("li",{children:[c.item.name,"＊",n.jsx("span",{className:c.quantity>1?"text-danger":"",children:c.quantity}),c.children.length?n.jsx("ul",{children:c.children.map(s=>n.jsxs("li",{children:[s.item.name,"＊",n.jsx("span",{className:s.quantity>1?"text-danger":"",children:s.quantity})]},s.accountItemId))}):""]},c.accountItemId))})]}),n.jsxs("div",{children:[n.jsx(m,{variant:"outline-success",type:"button",value:r,onClick:e.changeToOrdered,className:"d-block w-100 py-2 mb-2",children:"注文済み"}),n.jsx(m,{variant:"secondary",type:"button",value:r,onClick:e.changeToProgress,className:"d-block w-100 py-2 mb-2",children:"準備中"}),n.jsx(m,{variant:"primary",type:"button",value:r,onClick:e.changeToCompleted,className:"d-block w-100 py-2 mb-2",children:"完了・引き渡し済み"})]})]},r))})})}function E(){const e=u.useRef(null),r=u.useCallback(s=>{if(e.current!==null||s.esUrl==="")return;const o=new EventSource(s.esUrl);o.onopen=function(a){console.log("es was opened"),s.onOpen&&s.onOpen(a)},o.onmessage=function(a){const i=JSON.parse(a.data),l={...a,data:i};s.onMessage&&s.onMessage(l)},o.onerror=function(a){s.onError&&s.onError(a)},e.current=o},[]),c=u.useCallback(()=>{e.current!==null&&(e.current.close(),e.current=null,console.log("es was closed"))},[e.current]);return{openES:r,closeES:c,ESRef:e}}function w(){const[e,r]=u.useState({}),{openES:c,closeES:s}=E(),o=u.useRef(null),a=u.useRef(null);u.useEffect(()=>{if(o.current=document.getElementById("project"),a.current=document.getElementById("progress"),!(!o.current||!a.current))return c({esUrl:`/api/v1/project/${o.current.value}/account?sse=true&order_status=ordered&progress=${a.current.value}`,onMessage:i}),()=>{s()}},[]);function i(t){if(t.data.order_status==="completed"){e[t.data.accountId]&&delete e[t.data.accountId],r({...e});return}e[t.data.accountId]=t.data,r({...e})}async function l(t,d){if(!o.current||!a.current)return;const g=new y({project:o.current.value});g.setResourceId(t),e[t].order_status=d,await g.update(e[t]),r({...e})}function x(t){l(t.currentTarget.value,"ordered")}function f(t){l(t.currentTarget.value,"progress")}async function j(t){const d=t.currentTarget.value;await l(t.currentTarget.value,"completed"),e[d]&&delete e[d],r({...e})}return n.jsx(n.Fragment,{children:n.jsx(p,{Accounts:e,changeToCompleted:j,changeToOrdered:x,changeToProgress:f})})}b("root",n.jsx(w,{}));

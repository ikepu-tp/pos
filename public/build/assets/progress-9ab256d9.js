import{j as r,B as i,R as p,C as y,r as l,M as v,A as w,a as b}from"./index-661bdd0b.js";function E(e){return r.jsxs(r.Fragment,{children:[r.jsx("div",{children:r.jsx(i,{type:"button",onClick:e.logout,children:"ログアウト"})}),r.jsx(p,{children:Object.keys(e.Accounts).map(n=>r.jsxs(y,{xs:"auto",sm:"auto",md:"auto",lg:"auto",className:"m-3 p-3 border border-dark rounded",children:[r.jsxs("div",{className:"mb-1",children:["会計ID:",n]}),r.jsxs("div",{children:["処理状況：",e.Accounts[n].order_status==="ordered"&&r.jsx("span",{className:"text-warning",children:"注文済み"}),e.Accounts[n].order_status==="progress"&&r.jsx("span",{className:"text-danger",children:"準備中"}),e.Accounts[n].order_status==="completed"&&r.jsx("span",{className:"text-primary",children:"完了・引き渡し済み"})]}),r.jsxs("div",{className:"my-2",children:["注文内容",r.jsx("ul",{className:"fs-4",children:e.Accounts[n].items.map(c=>r.jsxs("li",{children:[c.item.name,"＊",r.jsx("span",{className:c.quantity>1?"text-danger":"",children:c.quantity}),c.children.length?r.jsx("ul",{children:c.children.map(t=>r.jsxs("li",{children:[t.item.name,"＊",r.jsx("span",{className:t.quantity>1?"text-danger":"",children:t.quantity})]},t.accountItemId))}):""]},c.accountItemId))})]}),r.jsxs("div",{children:[r.jsx(i,{variant:"outline-success",type:"button",value:n,onClick:e.changeToOrdered,className:"d-block w-100 py-2 mb-2",children:"注文済み"}),r.jsx(i,{variant:"secondary",type:"button",value:n,onClick:e.changeToProgress,className:"d-block w-100 py-2 mb-2",children:"準備中"}),r.jsx(i,{variant:"primary",type:"button",value:n,onClick:e.changeToCompleted,className:"d-block w-100 py-2 mb-2",children:"完了・引き渡し済み"})]})]},n))})]})}function N(){const e=l.useRef(null),n=l.useCallback(t=>{if(e.current!==null||t.esUrl==="")return;const o=new EventSource(t.esUrl);o.onopen=function(a){console.log("es was opened"),t.onOpen&&t.onOpen(a)},o.onmessage=function(a){const g=JSON.parse(a.data),m={...a,data:g};t.onMessage&&t.onMessage(m)},o.onerror=function(a){t.onError&&t.onError(a)},e.current=o},[]),c=l.useCallback(()=>{e.current!==null&&(e.current.close(),e.current=null,console.log("es was closed"))},[e.current]);return{openES:n,closeES:c,ESRef:e}}class k extends v{constructor(){super(...arguments),this.path="/v1/progress/{progress}",this.resourceId_key="progress"}}function C(){const[e,n]=l.useState({}),{openES:c,closeES:t}=N(),o=l.useRef(null),a=l.useRef(null);l.useEffect(()=>{if(o.current=document.getElementById("project"),a.current=document.getElementById("progress"),!(!o.current||!a.current))return c({esUrl:`/api/v1/project/${o.current.value}/account?sse=true&order_status=ordered&progress=${a.current.value}`,onMessage:m}),()=>{t()}},[]);async function g(){var d;const u=await new k({progress:(d=a.current)==null?void 0:d.value}).update({logged:!1});if(!u||!u.payloads)throw new Error("Unexpected response.");t(),n({})}function m(s){if(s.data.order_status==="completed"){e[s.data.accountId]&&delete e[s.data.accountId],n({...e});return}e[s.data.accountId]=s.data,n({...e})}async function x(s,u){if(!o.current||!a.current)return;const d=new w({project:o.current.value});d.setResourceId(s),e[s].order_status=u,await d.update(e[s]),n({...e})}function h(s){x(s.currentTarget.value,"ordered")}function f(s){x(s.currentTarget.value,"progress")}async function j(s){const u=s.currentTarget.value;await x(s.currentTarget.value,"completed"),e[u]&&delete e[u],n({...e})}return r.jsx(r.Fragment,{children:r.jsx(E,{Accounts:e,changeToCompleted:j,changeToOrdered:h,changeToProgress:f,logout:g})})}b("root",r.jsx(C,{}));
